%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Structured General Purpose Assignment
% LaTeX Template
%
% Original author:
% Ted Pavlic (http://www.tedpavlic.com)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%   PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass{article}

\usepackage{fancyhdr} % Required for custom headers
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers
\usepackage{graphicx} % Required to insert images
\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template

\usepackage[T1]{fontenc} % Codificación de las fuentes utilizadas
\usepackage[spanish]{babel} % Español como idioma principal del texto (permite hyphenation de palabras al final de una línea)
\selectlanguage{spanish}
\usepackage{hyperref}
\usepackage{listings}

\input{includes}
   
%----------------------------------------------------------------------------------------
%   NAME AND CLASS SECTION
%----------------------------------------------------------------------------------------

\newcommand{\hmwkTitle}{MKPolohomedir. Módulo de PAM para la gestión de usuarios} % Assignment title
\newcommand{\hmwkDueDate}{Viernes,\ 1\ de\ mayo\ de\ 2015}
\newcommand{\hmwkAuthorName}{Diego Martín Arroyo} % Your name

%----------------------------------------------------------------------------------------
%   TITLE PAGE
%----------------------------------------------------------------------------------------

\title{\hmwkTitle}
\author{\textbf{\hmwkAuthorName}}
\date{1 de mayo de 2015}

%----------------------------------------------------------------------------------------

\begin{document}

\maketitle

%----------------------------------------------------------------------------------------
%   TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

\setcounter{tocdepth}{1}

\newpage
\tableofcontents

\section{Introducción}

La gestión de los usuarios debe ser realizada de forma transparente. Permitiendo a los usuarios acceder al mismo en cualquier nodo y sin ningún tipo de configuración necesaria por su parte, acceder a todos los recursos presentes en el resto de nodos.

El sistema delega parte de la gestión de los usuarios a un directorio \textbf{LDAP}, gestionando el acceso al sistema mediante el módulo \textbf{PAM}. Sin embargo, debido a las necesidades particulares del sistema, la configuración básica de \textbf{PAM} y las herramientas incluidas no son suficientes para conseguir el funcionamiento deseado, y por ello es necesario desarrollar un conjunto de herramientas propias.

\section{Necesidades}

El sistema se compone de una serie de nodos independientes a los cuales pueden acceder los usuarios indistintamente. Se desea que los usuarios puedan utilizar los recursos presentes en cualquier nodo sin tener que acceder directamente a ellos (mediante una sesión remota, por ejemplo), y puedan empezar a trabajar sin tener que realizar ningún tipo de configuración.

Esta necesidad está parcialmente cubierta por los módulo de PAM \textbf{pam\_unix.so} (gestión de usuarios locales)\cite{man_pam_unix}, \textbf{pam\_ldap.so} (gestión de usuarios del servidor \textbf{LDAP})\cite{man_pam_ldap} y en particular \textbf{pam\_mkhomedir.so}\cite{man_pam_mkhomedir}, que permite la creación de un directorio de usuario si el mismo ha iniciado sesión por primera vez en esta máquina.

Sin embargo, una de las características del sistema es la uniformidad de sus nodos en cuando a usuarios se refiere. Por ello, es deseable que los usuarios cuenten con un conjunto básico de datos en cualquier nodo del sistema a la hora de acceder por primera vez. El módulo \textbf{pam\_mkhomedir} no lleva a cabo esta tarea, pues únicamente crea el directorio (realizando una copia de \texttt{/etc/skel} de inicio del usuario en la máquina donde se ha realizado el acceso).

Es por tanto necesario crear un mecanismo para llevar a cabo dicha tarea. Aprovechando la funcionalidad de PAM, se ha procedido a crear un módulo complementario a \textbf{pam\_mkhomedir} denominado \textbf{pam\_mkpolohomedir}, que aprovecha la herramienta \textbf{MarcoPolo} para realizar su cometido.

\section{Características del módulo}

La funcionalidad de un módulo de \textbf{PAM} se recoge en un objecto compartido que se vincula en tiempo de ejecución con el resto de componentes de \textbf{PAM} según se disponga en los ficheros de configuración del módulo (generalmente situados en \texttt{/etc/pam.d/}). \cite{linux-pam-guide} y que se debe almacenar en \texttt{/lib/security}.  

En el caso particular a resolver, el módulo será invocado tras la ejecución del módulo \textbf{pam\_mkhomedir}, y se encargará de, aprovechando la funcionalidad de MarcoPolo, detectar todos los nodos disponibles en la red y proceder a la creación en los mismos del directorio de inicio, así como la realización de una serie de tareas adicionales.

Toda la funcionalidad se recoge en el fichero \texttt{pam\_mkpolohomedir.c}. Dicho módulo recoge la información de interés (nombre, uid y gid del usuario) a través de llamadas al núcleo de \textbf{PAM}\cite{linux-pam-guide-ch2}.

\cfile{pam_mkpolohomedir}{Obtención de la información del usuario}{355}{372}

Una vez obtenida dicha información, las funciones \texttt{create\_polo\_homedir} y \texttt{createdirs} se encargan de la búsqueda de los nodos del sistema (aprovechando el \textit{binding} de \textbf{Marco}) y de contactar con ellos.

\section{Creación del directorio}

Cada nodo cuenta con una instancia del esclavo de \textbf{polousers}, el servicio que se encarga de recibir las peticiones de creación de usuarios. Dicho servicio se implementa sobre el \textit{framework} \textbf{Twisted}, y verifica la autoría de cada petición mediante sockets sobre TLS (\textit{Transport Layer Security}).

Una vez creado el directorio, el servicio así lo indica al solicitante, que almacena el registro de dicha operación.

\label{Referencias}
\lhead{\emph{Referencias}}
\bibliographystyle{ieeetr}  % Use the "unsrtnat" BibTeX style for formatting the Bibliography
\bibliography{polousers}  % The references (distcc) information are stored in the file named "distcc.bib"

\end{document}
